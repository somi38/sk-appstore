{
    "services": [
        {
            "name": "postgres",
            "image": "postgres:16-alpine",
            "restart": "unless-stopped",
            "environment": {
                "POSTGRES_DB": "postgres",
                "POSTGRES_USER": "postgres",
                "POSTGRES_PASSWORD": "${POSTGRES_PASSWORD}"
            },
            "volumes": [
                {
                    "hostPath": "${APP_DATA_DIR}/postgres",
                    "containerPath": "/var/lib/postgresql/data"
                }
            ],
            "healthCheck": {
                "test": "pg_isready -U postgres -d postgres",
                "interval": "10s",
                "timeout": "5s",
                "retries": 5
            }
        },
        {
            "name": "minio",
            "image": "minio/minio:latest",
            "restart": "unless-stopped",
            "command": "server /data",
            "environment": {
                "MINIO_ROOT_USER": "${MINIO_ROOT_USER}",
                "MINIO_ROOT_PASSWORD": "${MINIO_ROOT_PASSWORD}"
            },
            "volumes": [
                {
                    "hostPath": "${APP_DATA_DIR}/minio",
                    "containerPath": "/data"
                }
            ],
            "addPorts": [
                {
                    "containerPort": 9000,
                    "hostPort": 9000,
                    "tcp": true
                }
            ]
        },
        {
            "name": "chrome",
            "image": "ghcr.io/browserless/chromium:v2.18.0",
            "restart": "unless-stopped",
            "environment": {
                "TIMEOUT": "10000",
                "CONCURRENT": "10",
                "TOKEN": "${CHROME_TOKEN}",
                "EXIT_ON_HEALTH_FAILURE": "true",
                "PRE_REQUEST_HEALTH_CHECK": "true"
            },
            "extraHosts": [
                "host.docker.internal:host-gateway"
            ]
        },
        {
            "name": "app",
            "image": "amruthpillai/reactive-resume:latest",
            "restart": "unless-stopped",
            "isMain": true,
            "internalPort": 3000,
            "dependsOn": {
                "postgres": {
                    "condition": "service_healthy"
                },
                "minio": "service_started",
                "chrome": "service_started"
            },
            "environment": {
                "PORT": "3000",
                "NODE_ENV": "production",
                "PUBLIC_URL": "${PUBLIC_URL}",
                "STORAGE_URL": "${STORAGE_URL}",
                "CHROME_TOKEN": "${CHROME_TOKEN}",
                "CHROME_URL": "ws://chrome:3000",
                "DATABASE_URL": "postgresql://postgres:${POSTGRES_PASSWORD}@postgres:5432/postgres",
                "ACCESS_TOKEN_SECRET": "${ACCESS_TOKEN_SECRET}",
                "REFRESH_TOKEN_SECRET": "${REFRESH_TOKEN_SECRET}",
                "MAIL_FROM": "${MAIL_FROM}",
                "SMTP_URL": "${SMTP_URL}",
                "STORAGE_ENDPOINT": "minio",
                "STORAGE_PORT": "9000",
                "STORAGE_REGION": "us-east-1",
                "STORAGE_BUCKET": "default",
                "STORAGE_ACCESS_KEY": "${MINIO_ROOT_USER}",
                "STORAGE_SECRET_KEY": "${MINIO_ROOT_PASSWORD}",
                "STORAGE_USE_SSL": "false",
                "STORAGE_SKIP_BUCKET_CHECK": "false",
                "DISABLE_SIGNUPS": "${DISABLE_SIGNUPS}"
            }
        }
    ]
}
